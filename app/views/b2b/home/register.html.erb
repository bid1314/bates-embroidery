<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card shadow">
      <div class="card-header bg-dark text-white text-center">
        <h4><i class="fas fa-building me-2"></i>Apply for B2B Account</h4>
        <p class="mb-0">Get access to wholesale pricing and B2B features</p>
      </div>
      <div class="card-body">
        <%= form_with(url: user_registration_path, local: true, class: "needs-validation", novalidate: true) do |form| %>
          <!-- Hidden field to set B2B role -->
          <%= form.hidden_field :role, value: 'b2b_customer' %>
          
          <div class="row">
            <!-- Basic Account Information -->
            <div class="col-md-6">
              <h6 class="text-muted mb-3">Account Information</h6>
              
              <div class="mb-3">
                <%= form.label :email, class: "form-label" %>
                <%= form.email_field :email, autofocus: true, autocomplete: "email", class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide a valid email address.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :password, class: "form-label" %>
                <%= form.password_field :password, autocomplete: "new-password", class: "form-control", required: true, minlength: 6 %>
                <div class="invalid-feedback">
                  Password must be at least 6 characters long.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :password_confirmation, "Confirm Password", class: "form-label" %>
                <%= form.password_field :password_confirmation, autocomplete: "new-password", class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Passwords must match.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :first_name, class: "form-label" %>
                <%= form.text_field :first_name, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your first name.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :last_name, class: "form-label" %>
                <%= form.text_field :last_name, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your last name.
                </div>
              </div>
            </div>

            <!-- Business Information -->
            <div class="col-md-6">
              <h6 class="text-muted mb-3">Business Information</h6>
              
              <div class="mb-3">
                <%= form.label :company_name, class: "form-label" %>
                <%= form.text_field :company_name, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your company name.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :tax_id, "Business Tax ID", class: "form-label" %>
                <%= form.text_field :tax_id, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your business tax ID.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :website, "Company Website", class: "form-label" %>
                <%= form.url_field :website, class: "form-control", placeholder: "https://yourcompany.com" %>
                <small class="form-text text-muted">Optional but recommended</small>
              </div>

              <div class="mb-3">
                <%= form.label :phone, "Business Phone", class: "form-label" %>
                <%= form.tel_field :phone, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your business phone number.
                </div>
              </div>

              <div class="mb-3">
                <%= form.label :expected_volume, "Expected Annual Volume", class: "form-label" %>
                <%= form.select :expected_volume, 
                    options_for_select([
                      ['50-100 pieces', '50-100'],
                      ['101-500 pieces', '101-500'],
                      ['501-1,000 pieces', '501-1000'],
                      ['1,001-10,000 pieces', '1001-10000'],
                      ['10,000+ pieces', '10000+']
                    ]), 
                    { prompt: 'Select expected volume' }, 
                    { class: "form-select", required: true } %>
                <div class="invalid-feedback">
                  Please select your expected annual volume.
                </div>
              </div>
            </div>
          </div>

          <!-- Supplier Information -->
          <div class="row">
            <div class="col-12">
              <h6 class="text-muted mb-3 mt-3">Supplier Account Information (Optional)</h6>
              <p class="small text-muted">If you have existing accounts with our suppliers, provide your account numbers to receive the same pricing you already get.</p>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :sanmar_account, "SanMar Customer Number", class: "form-label" %>
                <%= form.text_field :sanmar_account, class: "form-control", placeholder: "e.g., 123456" %>
                <small class="form-text text-muted">If you have a SanMar account</small>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :ss_activewear_account, "S&S Activewear Customer Number", class: "form-label" %>
                <%= form.text_field :ss_activewear_account, class: "form-control", placeholder: "e.g., 789012" %>
                <small class="form-text text-muted">If you have an S&S Activewear account</small>
              </div>
            </div>
          </div>

          <!-- Business Address -->
          <div class="row">
            <div class="col-12">
              <h6 class="text-muted mb-3 mt-3">Business Address</h6>
            </div>
            
            <div class="col-12">
              <div class="mb-3">
                <%= form.label :address_line_1, "Address Line 1", class: "form-label" %>
                <%= form.text_field :address_line_1, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your business address.
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="mb-3">
                <%= form.label :address_line_2, "Address Line 2", class: "form-label" %>
                <%= form.text_field :address_line_2, class: "form-control" %>
                <small class="form-text text-muted">Suite, unit, building, floor, etc. (optional)</small>
              </div>
            </div>

            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :city, class: "form-label" %>
                <%= form.text_field :city, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your city.
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :state, class: "form-label" %>
                <%= form.text_field :state, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your state.
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :zip_code, "ZIP Code", class: "form-label" %>
                <%= form.text_field :zip_code, class: "form-control", required: true %>
                <div class="invalid-feedback">
                  Please provide your ZIP code.
                </div>
              </div>
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="row">
            <div class="col-12">
              <div class="mb-3 form-check">
                <%= form.check_box :terms_accepted, class: "form-check-input", required: true %>
                <%= form.label :terms_accepted, class: "form-check-label" do %>
                  I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">B2B Account Agreement</a>
                <% end %>
                <div class="invalid-feedback">
                  You must agree to the terms and conditions.
                </div>
              </div>
            </div>
          </div>

          <div class="d-grid">
            <%= form.submit "Submit B2B Application", class: "btn btn-dark btn-lg" %>
          </div>
        <% end %>

        <hr class="my-4">

        <div class="text-center">
          <p class="text-muted">Already have a B2B account?</p>
          <%= link_to "Login to B2B Portal", b2b_login_path, class: "btn btn-outline-dark" %>
        </div>

        <div class="text-center mt-3">
          <small class="text-muted">
            Looking for retail pricing? 
            <%= link_to "Visit Retail Store", "http://retail.batesembroidery.com", class: "text-decoration-none" %>
          </small>
        </div>
      </div>
    </div>

    <!-- Application Process Info -->
    <div class="card mt-4 border-0 bg-light">
      <div class="card-body">
        <h6 class="text-center mb-3">Application Process</h6>
        <div class="row text-center">
          <div class="col-md-3">
            <i class="fas fa-file-alt fa-2x text-dark mb-2"></i>
            <h6>1. Submit</h6>
            <small class="text-muted">Complete the application form</small>
          </div>
          <div class="col-md-3">
            <i class="fas fa-search fa-2x text-dark mb-2"></i>
            <h6>2. Review</h6>
            <small class="text-muted">We verify your business information</small>
          </div>
          <div class="col-md-3">
            <i class="fas fa-check-circle fa-2x text-dark mb-2"></i>
            <h6>3. Approval</h6>
            <small class="text-muted">Receive approval notification</small>
          </div>
          <div class="col-md-3">
            <i class="fas fa-shopping-cart fa-2x text-dark mb-2"></i>
            <h6>4. Shop</h6>
            <small class="text-muted">Access wholesale pricing</small>
          </div>
        </div>
        <div class="text-center mt-3">
          <small class="text-muted">
            <i class="fas fa-clock me-1"></i>
            Typical approval time: 1-2 business days
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Password confirmation validation
document.addEventListener('DOMContentLoaded', function() {
  const password = document.getElementById('user_password');
  const passwordConfirmation = document.getElementById('user_password_confirmation');
  
  function validatePassword() {
    if (password.value !== passwordConfirmation.value) {
      passwordConfirmation.setCustomValidity("Passwords don't match");
    } else {
      passwordConfirmation.setCustomValidity('');
    }
  }
  
  password.addEventListener('change', validatePassword);
  passwordConfirmation.addEventListener('keyup', validatePassword);
});
</script>